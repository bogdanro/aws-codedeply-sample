files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/45_yarn_install.sh":
    mode: "000755"
    owner: root
    group: users
    content: |
      #!/usr/bin/env bash

      EB_NODE_VERSION=$(/opt/elasticbeanstalk/bin/get-config optionsettings -n aws:elasticbeanstalk:container:nodejs -o NodeVersion)

      # Make sure Node binaries can be found (required to run npm).
      # And this lets us invoke npm more simply too.
      export PATH=/opt/elasticbeanstalk/node-install/node-v$EB_NODE_VERSION-linux-x64/bin:$PATH

      # If yarn is not detected, install it.
      if which yarn; then
        echo "Skipping installation of yarn -- yarn already installed."
        echo "yarn --version: `yarn --version`"
      else
        echo "Installing yarn..."
        # Download the yarn repo
        sudo wget https://dl.yarnpkg.com/rpm/yarn.repo -O /etc/yum.repos.d/yarn.repo
        # Confirm that it downloaded
        file /etc/yum.repos.d/yarn.repo
	# install yarn
        sudo yum install -y yarn
        echo "yarn --version: `yarn --version`"
        echo "... and finished installing yarn."
      fi
